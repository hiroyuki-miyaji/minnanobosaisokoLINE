<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç®¡ç†å€‰åº«ä¸€è¦§</title>

<script src="https://static.line-scdn.net/liff/2.22.1/sdk.js"></script>
<link rel="stylesheet" href="css/style.css">
<script defer src="js/liff.js"></script>
<script defer src="js/api.js"></script>

</head>
<body>

<h2>ç®¡ç†ä¸­ã®é˜²ç½å€‰åº«</h2>
<button class="btn primary" onclick="location.href='register_warehouse.html'">
ï¼‹ å€‰åº«ã‚’è¿½åŠ 
</button>

<div id="warehouseList"></div>

<script>
async function loadWarehouses() {
    const LINEID = await getUserId();
    const result = await callApi({
        action: "listWarehouses",
        LINEID
    });

    const area = document.getElementById("warehouseList");
    area.innerHTML = "";

    if (!result || result.length === 0) {
        area.innerHTML = "<p>ç™»éŒ²ã•ã‚ŒãŸå€‰åº«ãŒã‚ã‚Šã¾ã›ã‚“</p>";
        return;
    }

    result.forEach(w => {
        area.innerHTML += `
        <div class="card">
            <img src="${w.imageurl || 'assets/placeholder.png'}" class="thumb">

            <div class="info">
                <h3>${w.detail}</h3>
                <p><b>ç•ªå·ï¼š</b>${w.number}</p>
                <p><b>ä½æ‰€ï¼š</b>${w.address}</p>
                <p><b>çŠ¶æ…‹ï¼š</b>${w.ispublished ? "ğŸ”“ è§£éŒ ä¸­" : "ğŸ”’ æ–½éŒ ä¸­"}</p>
            </div>

            <div class="actions">
                <button class="btn green"
                    onclick="operate('${w.number}', 'unlock')"
                    ${w.ispublished ? "" : "disabled"}>
                    ğŸ”“ è§£éŒ 
                </button>

                <button class="btn orange"
                    onclick="operate('${w.number}', 'notifyUnlock')"
                    ${w.ispublished ? "" : "disabled"}>
                    ğŸ“¢ é€šçŸ¥è§£éŒ 
                </button>

                <button class="btn gray"
                    onclick="operate('${w.number}', 'lock')"
                    ${!w.ispublished ? "" : "disabled"}>
                    ğŸ”’ æ–½éŒ 
                </button>

                <button class="btn secondary"
                    onclick="location.href='editWarehouse.html?number=${w.number}'">
                    âœï¸ ç·¨é›†
                </button>
            </div>
        </div>
        `;
    });
}

async function operate(number, operation) {
    const LINEID = await getUserId();
    await callApi({
        action: "operateWarehouse",
        LINEID,
        number,
        operation
    });

    alert("æ“ä½œãŒå®Œäº†ã—ã¾ã—ãŸ");
    loadWarehouses();
}

loadWarehouses();
</script>

</body>
</html>
