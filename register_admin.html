<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理者情報登録</title>

    <script src="https://static.line-scdn.net/liff/2.22.1/sdk.js"></script>
    <link rel="stylesheet" href="./css/style.css" />
</head>
<body>

<h2>管理者情報の登録 / 更新</h2>

<div class="form">
    <label>氏名</label>
    <input id="name" type="text" />

    <label>所属</label>
    <input id="org" type="text" />

    <label>連絡先メールアドレス</label>
    <input id="email" type="email" />

    <button class="btn" id="saveBtn">保存する</button>
</div>

<script src="./js/liff.js"></script>
<script src="./js/api.js"></script>

<script>
async function main() {
    await initLiff(LIFF_ID);
    const lineId = await getLineId();

    const admin = await getAdmin(lineId);

    if (admin && admin.exists) {
        document.getElementById("name").value = admin.name || "";
        document.getElementById("org").value = admin.org || "";
        document.getElementById("email").value = admin.email || "";
    }

    document.getElementById("saveBtn").onclick = async () => {
        const data = {
            LINEID: lineId,
            name: document.getElementById("name").value,
            org: document.getElementById("org").value,
            email: document.getElementById("email").value
        };

        const result = await registerAdmin(data);
        if (result.success) {
            alert("保存しました！");
            location.href = "./index.html";
        } else {
            alert("保存に失敗しました");
        }
    };
}

main();
</script>

</body>
</html>
