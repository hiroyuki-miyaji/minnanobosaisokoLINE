<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理者登録</title>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="./js/api.js?v=1005"></script>
    <script type="module" src="./js/liff.js?v=1005"></script>

    <link rel="stylesheet" href="./css/style.css?v=1005">
</head>
<body>

<h2>管理者情報登録</h2>

<div id="formArea">
    <label>氏名</label><br>
    <input id="name" type="text"><br><br>

    <label>メール</label><br>
    <input id="email" type="email"><br><br>

    <label>所属名</label><br>
    <input id="company" type="text"><br><br>

    <button id="btn" class="btn btn-green">登録する</button>
</div>

<div id="debugArea" class="debug"></div>

<script type="module">
import { initLiff, getUserProfile, debug } from "./js/liff.js?v=1005";

async function main() {
    await initLiff();
    const profile = await getUserProfile();
    const lineId = profile.userId;

    document.getElementById("btn").onclick = async () => {
        const payload = {
            LINEID: lineId,
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            organization: document.getElementById("company").value
        };

        debug("send registerAdmin: " + JSON.stringify(payload));

        const result = await registerAdmin(payload);

        debug("response: " + JSON.stringify(result));

        if (result && result.admin) {
            // admin 情報を index.html に渡す
            const encoded = encodeURIComponent(JSON.stringify(result.admin));
            location.href = `./index.html?admin=${encoded}`;
        } else {
            alert("登録に失敗しました");
        }
    };
}

main();
</script>

</body>
</html>
