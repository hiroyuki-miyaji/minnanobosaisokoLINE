<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>みんなの防災倉庫 管理者用アプリ</title>

    <!-- LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/2.22.1/sdk.js"></script>
    <link rel="stylesheet" href="./css/style.css">

    <style>
        .btn-disabled {
            background: #cccccc !important;
            pointer-events: none;
            color: #666 !important;
        }
    </style>
</head>
<body>

<h2>みんなの防災倉庫 管理者用アプリ</h2>
<div id="status">ログイン処理中...</div>

<hr>

<h3>メニュー</h3>

<a id="btnAdmin" class="btn" href="./register_admin.html">
    管理者情報の登録 / 更新
</a>

<a id="btnRegWarehouse" class="btn" href="./register_warehouse.html">
    防災倉庫の登録
</a>

<a id="btnList" class="btn" href="./list.html">
    管理中の倉庫一覧
</a>

<p id="note"></p>

<script src="./js/api.js"></script>
<script src="./js/liff.js"></script>

<script>
    const LIFF_ID = "2008561144-5WLWMVPP";

    async function main() {
        await liff.init({ liffId: LIFF_ID });

        if (!liff.isLoggedIn()) {
            liff.login();
            return;
        }

        const profile = await liff.getProfile();
        const lineId = profile.userId;

        document.getElementById("status").innerHTML =
            `${profile.displayName} さんとしてログインしました。`;

        // 管理者情報を取得
        const admin = await getAdmin(lineId);

        if (!admin || !admin.crfd1_lineid) {
            // ❌ 管理者未登録モード：管理者登録以外は押せない
            document.getElementById("btnRegWarehouse").classList.add("btn-disabled");
            document.getElementById("btnList").classList.add("btn-disabled");

            document.getElementById("note").innerHTML =
                "※ 管理者情報が登録されていません。「管理者登録 / 更新」から登録してください。";

        } else {
            // ✔ 管理者登録済：すべて使用可能
            document.getElementById("note").innerHTML =
                "管理者登録済みです。メニューから操作してください。";
        }
    }

    main();
</script>

</body>
</html>
